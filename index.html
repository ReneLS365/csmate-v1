<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>akkordseddel</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="print.css" media="print">
</head>
<body>
<header>
  <div class="bar">
    <div class="ttl">akkordseddel</div>
    <nav>
      <button id="btnSagsinfo" data-section="sagsinfo" class="active" type="button">Sagsinfo</button>
      <button id="btnOptaelling" data-section="optaelling" type="button">Opt√¶lling</button>
      <button id="btnLon" data-section="lon" type="button">L√∏n</button>
      <button id="btnGuide" data-section="guide" type="button">Guide</button>
    </nav>
  </div>
</header>
<main>
  <section id="sagsinfoSection" class="sektion">
    <fieldset>
      <legend>Stamdata</legend>
      <div class="form-grid grid-3">
        <label for="sagsnummer">
          <span>Sagsnummer</span>
          <input id="sagsnummer" name="sagsnummer" type="text" required>
        </label>
        <label for="sagsnavn">
          <span>Navn/opgave</span>
          <input id="sagsnavn" name="navn" type="text" required>
        </label>
        <label for="sagsadresse">
          <span>Adresse</span>
          <input id="sagsadresse" name="adresse" type="text" required>
        </label>
        <label for="sagskunde">
          <span>Kunde</span>
          <input id="sagskunde" name="kunde" type="text" required>
        </label>
        <label for="sagsdato" class="date-field">
          <span>Dato</span>
          <div class="date-input-wrapper">
            <input id="sagsdato" name="dato" type="date" required inputmode="numeric">
            <button id="calendarIcon" class="date-picker-trigger" type="button" aria-label="√Öbn kalender">üìÖ</button>
          </div>
        </label>
        <label for="sagsmontoer" class="col-span-3">
          <span>Mont√∏rnavne</span>
          <textarea id="sagsmontoer" name="montoer" rows="3" placeholder="Fx: Anna Jensen, Bo Nielsen" required></textarea>
        </label>
      </div>
    </fieldset>
  </section>

  <section id="optaellingSection" class="sektion" hidden>
    <fieldset>
      <legend>Systemer</legend>
      <div id="listSelectors" class="row"></div>
    </fieldset>

    <fieldset>
      <legend>Materialer</legend>
      <div id="optaellingContainer" class="materials"></div>
    </fieldset>

    <section id="overview" class="overview">
      <div class="totals">
        <div>
          <span>Materialesum</span>
          <strong id="total-material">0,00</strong>
        </div>
        <div>
          <span>L√∏nsum</span>
          <strong id="total-labor">0,00</strong>
        </div>
        <div>
          <span>Projektsum</span>
          <strong id="total-project">0,00</strong>
        </div>
      </div>
    </section>

    <section id="importer" class="import-zone no-print">
      <input id="csvFileInput" type="file" accept=".csv,text/csv" hidden>
      <div id="dropArea" class="drop-area" role="button" tabindex="0" aria-label="Tr√¶k en CSV hertil eller klik for at v√¶lge">
        <p><strong>Importer CSV</strong></p>
        <p>Tr√¶k og slip din CSV her, eller klik for at v√¶lge</p>
      </div>
    </section>

    <div class="row btn-group no-print">
      <button id="btnExportCSV" type="button" disabled>Del til E‚Äëkomplet (CSV)</button>
      <button id="btnExportAll" type="button" disabled>Eksport√©r PDF + CSV</button>
    </div>
    <p id="actionHint" class="hint no-print">Udfyld Sagsinfo for at forts√¶tte.</p>

    <fieldset class="no-print">
      <legend>Admin</legend>
      <div class="row">
        <label class="sr-only" for="adminCode">Admin kode</label>
        <input id="adminCode" placeholder="Kode">
        <button type="button" onclick="login()">Log ind</button>
      </div>
      <p id="adminFeedback" class="status-message" hidden aria-live="polite"></p>
    </fieldset>
  </section>

  <section id="lonSection" class="sektion" hidden>
    <fieldset>
      <legend>Type & bel√∏b</legend>
      <div class="grid-3">
        <label for="jobType"><span>Arbejdstype</span>
          <select id="jobType">
            <option value="montage">Montage</option>
            <option value="demontage">Demontage (50%)</option>
          </select>
        </label>
        <label for="montagepris"><span>Montagepris (auto)</span>
          <input id="montagepris" placeholder="Montagepris (auto)" inputmode="decimal">
        </label>
        <label for="demontagepris"><span>Demontagepris (auto)</span>
          <input id="demontagepris" placeholder="Demontagepris (auto)" inputmode="decimal">
        </label>
      </div>
    </fieldset>
    <fieldset>
      <legend>Till√¶g & km</legend>
      <div class="grid-3">
        <label for="slaebePct"><span>Sl√¶b i %</span>
          <input id="slaebePct" placeholder="Sl√¶b i %" inputmode="decimal">
        </label>
        <label for="antalBoringHuller"><span>Huller (antal)</span>
          <input id="antalBoringHuller" placeholder="Huller (antal)" inputmode="numeric">
        </label>
        <label for="antalLukHuller"><span>Luk af hul (antal)</span>
          <input id="antalLukHuller" placeholder="Luk af hul (antal)" inputmode="numeric">
        </label>
        <label for="antalBoringBeton"><span>Boring i beton (antal)</span>
          <input id="antalBoringBeton" placeholder="Boring i beton (antal)" inputmode="numeric">
        </label>
        <label for="km"><span>Km</span>
          <input id="km" placeholder="Km" inputmode="decimal">
        </label>
      </div>
    </fieldset>

    <fieldset>
      <legend>Trallel√∏ft</legend>
      <div class="grid-2">
        <label for="traelleloeft35"><span>Trallel√∏ft 0,35 (antal)</span>
          <input id="traelleloeft35" placeholder="Trallel√∏ft 0,35 (antal)" inputmode="numeric">
        </label>
        <label for="traelleloeft50"><span>Trallel√∏ft 0,50 (antal)</span>
          <input id="traelleloeft50" placeholder="Trallel√∏ft 0,50 (antal)" inputmode="numeric">
        </label>
      </div>
    </fieldset>

    <fieldset class="no-print">
      <legend>Medarbejdere</legend>
      <div id="workers"></div>
      <div class="row">
        <button id="btnAddWorker" type="button">+ Tilf√∏j mand</button>
      </div>
    </fieldset>
    <div class="row no-print btn-group">
      <button id="btnBeregnLon" type="button">Beregn l√∏n</button>
      <button id="btnPrint" type="button" disabled>Print</button>
    </div>
    <fieldset>
      <legend>Resultat</legend>
      <div id="lonResult"></div>
    </fieldset>
  </section>

  <section id="guideSection" class="sektion" hidden>
    <article class="guide-intro">
      <h2>S√•dan bruger du CSMate</h2>
      <p>
        Brug fanerne √∏verst til at udfylde sagsinfo, registrere materialer og beregne l√∏n. Klik p√•
        knappen herunder for at √•bne den detaljerede trin-for-trin guide.
      </p>
      <button id="btnOpenGuideModal" type="button">√Öbn guide</button>
    </article>
  </section>
</main>

<div id="guideModal" class="modal" hidden aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="guideModalTitle" tabindex="-1">
    <button type="button" class="modal-close" aria-label="Luk">√ó</button>
    <h2 id="guideModalTitle">Guide til CSMate</h2>
    <p>
      F√∏lg disse trin for at genskabe den stabile arbejdsgang:
    </p>
    <ol>
      <li>Udfyld <strong>Sagsinfo</strong> med de grundl√¶ggende oplysninger.</li>
      <li>V√¶lg system i <strong>Opt√¶lling</strong> og indtast materialer.</li>
      <li>Importer eller eksporter CSV efter behov og gener√©r PDF.</li>
      <li>Tilf√∏j medarbejdere under <strong>L√∏n</strong> og beregn akkord.</li>
    </ol>
    <p>
      Har du brug for yderligere hj√¶lp, kan du kontakte administratoren eller sl√• op i virksomhedens
      interne vejledninger.
    </p>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="main.js"></script>
<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').then(reg => {
      reg.onupdatefound = () => {
        const newWorker = reg.installing;
        if (!newWorker) return;
        newWorker.onstatechange = () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            window.location.reload();
          }
        };
      };
    });
  }
</script>
</body>
</html>
